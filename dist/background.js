(()=>{"use strict";var e,t,n={},r={};function a(e){var t=r[e];if(void 0!==t)return t.exports;var s=r[e]={exports:{}};return n[e](s,s.exports,a),s.exports}a.m=n,a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,n)=>(a.f[n](e,t),t)),[])),a.u=e=>e+".js",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="novelsynth:",a.l=(n,r,s,i)=>{if(e[n])e[n].push(r);else{var o,c;if(void 0!==s)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var h=l[d];if(h.getAttribute("src")==n||h.getAttribute("data-webpack")==t+s){o=h;break}}o||(c=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,a.nc&&o.setAttribute("nonce",a.nc),o.setAttribute("data-webpack",t+s),o.src=n),e[n]=[r];var u=(t,r)=>{o.onerror=o.onload=null,clearTimeout(m);var a=e[n];if(delete e[n],o.parentNode&&o.parentNode.removeChild(o),a&&a.forEach((e=>e(r))),t)return t(r)},m=setTimeout(u.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=u.bind(null,o.onerror),o.onload=u.bind(null,o.onload),c&&document.head.appendChild(o)}},(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=n[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={471:0};a.f.j=(t,n)=>{var r=a.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var s=new Promise(((n,a)=>r=e[t]=[n,a]));n.push(r[2]=s);var i=a.p+a.u(t),o=new Error;a.l(i,(n=>{if(a.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var s=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;o.message="Loading chunk "+t+" failed.\n("+s+": "+i+")",o.name="ChunkLoadError",o.type=s,o.request=i,r[1](o)}}),"chunk-"+t,t)}};var t=(t,n)=>{var r,s,[i,o,c]=n,l=0;if(i.some((t=>0!==e[t]))){for(r in o)a.o(o,r)&&(a.m[r]=o[r]);c&&c(a)}for(t&&t(n);l<i.length;l++)s=i[l],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0},n=self.webpackChunknovelsynth=self.webpackChunknovelsynth||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();class s{apiKey="";constructor(e){e&&(this.apiKey=e)}setApiKey(e){this.apiKey=e}validateApiKey(){if(!this.apiKey&&this.provider.requiresAuth)throw new Error(`API key required for ${this.provider.name}`)}async makeRequest(e,t){try{const n=await fetch(e,t);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return await n.json()}catch(e){throw console.error(`API request failed for ${this.provider.name}:`,e),e}}}class i{static countWords(e){if(!e||"string"!=typeof e)return 0;const t=e.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim();return t?t.split(/\s+/).filter((e=>e.length>0)).length:0}static countCharacters(e){return e&&"string"==typeof e?e.replace(/<[^>]*>/g,"").length:0}static calculateStats(e,t){const n=this.countWords(e),r=this.countWords(t),a=r-n,s=n>0?a/n*100:0,i=this.countCharacters(e),o=this.countCharacters(t);return{originalWords:n,enhancedWords:r,wordsChanged:a,percentageChange:Math.round(100*s)/100,charactersOriginal:i,charactersEnhanced:o}}static formatWordCount(e){return e<1e3?e.toString():e<1e6?(e/1e3).toFixed(1)+"K":(e/1e6).toFixed(1)+"M"}static formatPercentageChange(e){return`${e>0?"+":""}${e.toFixed(1)}%`}static formatWordChange(e){return`${e>0?"+":""}${this.formatWordCount(Math.abs(e))}`}static getReadingTime(e){const t=Math.round(e/200);if(t<1)return"< 1 min";if(t<60)return`${t} min`;{const e=Math.floor(t/60),n=t%60;return n>0?`${e}h ${n}m`:`${e}h`}}static extractContentWordCount(e){if(!e)return 0;const t=e.cloneNode(!0);return["nav","header","footer","aside",".ads",".navigation",".breadcrumb",".social",".share",".comments",".author-bio"].forEach((e=>{t.querySelectorAll(e).forEach((e=>e.remove()))})),this.countWords(t.textContent||"")}}class o extends s{provider={name:"Google Gemini",id:"gemini",apiEndpoint:"https://generativelanguage.googleapis.com/v1beta",requiresAuth:!0,authType:"api_key",features:["summarize","analyze","suggestions","keyPoints"]};async summarize(e,t){this.validateApiKey();const n=`Please provide a concise summary of the following content:\n\n${e}`;try{const e=await this.makeRequest(`${this.provider.apiEndpoint}/models/gemini-pro:generateContent?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:n}]}]})});return{summary:e.candidates?.[0]?.content?.parts?.[0]?.text||"No summary available"}}catch(e){return{error:`Failed to generate summary: ${e instanceof Error?e.message:"Unknown error"}`}}}async analyze(e,t){this.validateApiKey();const n=`Analyze the following content and provide insights about its structure, themes, and key points:\n\n${e}`;try{const e=await this.makeRequest(`${this.provider.apiEndpoint}/models/gemini-pro:generateContent?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:n}]}]})});return{analysis:e.candidates?.[0]?.content?.parts?.[0]?.text||"No analysis available"}}catch(e){return{error:`Failed to generate analysis: ${e instanceof Error?e.message:"Unknown error"}`}}}async generateSuggestions(e,t){this.validateApiKey();const n=`Based on the following content, provide helpful suggestions for better understanding or related topics to explore:\n\n${e}`;try{const e=await this.makeRequest(`${this.provider.apiEndpoint}/models/gemini-pro:generateContent?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:n}]}]})});return{suggestions:(e.candidates?.[0]?.content?.parts?.[0]?.text||"").split("\n").filter((e=>e.trim().length>0))}}catch(e){return{error:`Failed to generate suggestions: ${e instanceof Error?e.message:"Unknown error"}`}}}async enhance(e,t,n){this.validateApiKey();const r=Date.now();i.countWords(e);try{const n=await this.makeRequest(`${this.provider.apiEndpoint}/models/gemini-1.5-pro:generateContent?key=${this.apiKey}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:t}]}],generationConfig:{maxOutputTokens:8192,temperature:.7}})}),a=n.candidates?.[0]?.content?.parts?.[0]?.text||e;return{enhanced:a,processingTime:Date.now()-r,stats:i.calculateStats(e,a)}}catch(e){return{error:`Failed to enhance content: ${e instanceof Error?e.message:"Unknown error"}`}}}}class c extends s{provider={name:"OpenAI GPT",id:"openai",apiEndpoint:"https://api.openai.com/v1",requiresAuth:!0,authType:"api_key",features:["summarize","analyze","suggestions","keyPoints"]};async summarize(e,t){this.validateApiKey();try{const t=await this.makeRequest(`${this.provider.apiEndpoint}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are a helpful assistant that provides concise summaries of content."},{role:"user",content:`Please provide a concise summary of the following content:\n\n${e}`}],max_tokens:500,temperature:.7})});return{summary:t.choices?.[0]?.message?.content||"No summary available"}}catch(e){return{error:`Failed to generate summary: ${e instanceof Error?e.message:"Unknown error"}`}}}async analyze(e,t){this.validateApiKey();try{const t=await this.makeRequest(`${this.provider.apiEndpoint}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are a helpful assistant that analyzes content and provides insights."},{role:"user",content:`Analyze the following content and provide insights about its structure, themes, and key points:\n\n${e}`}],max_tokens:800,temperature:.7})});return{analysis:t.choices?.[0]?.message?.content||"No analysis available"}}catch(e){return{error:`Failed to generate analysis: ${e instanceof Error?e.message:"Unknown error"}`}}}async generateSuggestions(e,t){this.validateApiKey();try{const t=await this.makeRequest(`${this.provider.apiEndpoint}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are a helpful assistant that provides useful suggestions based on content."},{role:"user",content:`Based on the following content, provide 3-5 helpful suggestions for better understanding or related topics to explore:\n\n${e}`}],max_tokens:400,temperature:.8})});return{suggestions:(t.choices?.[0]?.message?.content||"").split("\n").filter((e=>e.trim().length>0&&(e.includes("•")||e.includes("-")||e.includes("1."))))}}catch(e){return{error:`Failed to generate suggestions: ${e instanceof Error?e.message:"Unknown error"}`}}}async enhance(e,t,n){this.validateApiKey();const r=Date.now(),a=n?.model||"gpt-4-turbo";try{const n=await this.makeRequest(`${this.provider.apiEndpoint}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify({model:a,messages:[{role:"user",content:t}],max_tokens:4096,temperature:.7})}),s=n.choices?.[0]?.message?.content||e;return{enhanced:s,processingTime:Date.now()-r,stats:i.calculateStats(e,s)}}catch(e){return{error:`Failed to enhance content: ${e instanceof Error?e.message:"Unknown error"}`}}}}class l extends s{provider={name:"Hugging Face",id:"huggingface",apiEndpoint:"https://api-inference.huggingface.co",requiresAuth:!0,authType:"api_key",features:["summarize","analyze"]};async summarize(e,t){this.validateApiKey();try{const t=await this.makeRequest(`${this.provider.apiEndpoint}/models/facebook/bart-large-cnn`,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({inputs:e.substring(0,1024),parameters:{max_length:200,min_length:50}})});return{summary:t[0]?.summary_text||"No summary available"}}catch(e){return{error:`Failed to generate summary: ${e instanceof Error?e.message:"Unknown error"}`}}}async analyze(e,t){this.validateApiKey();try{const t=(await this.makeRequest(`${this.provider.apiEndpoint}/models/cardiffnlp/twitter-roberta-base-sentiment-latest`,{method:"POST",headers:{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({inputs:e.substring(0,512)})}))[0];return{analysis:`Content Analysis:\n- Sentiment: ${t?.label||"Unknown"} (${(100*t?.score).toFixed(1)}% confidence)\n- Length: ${e.length} characters\n- Estimated reading time: ${Math.ceil(e.split(" ").length/200)} minutes`}}catch(e){return{error:`Failed to generate analysis: ${e instanceof Error?e.message:"Unknown error"}`}}}async generateSuggestions(e,t){return{suggestions:["Consider reading similar content on this topic","Look up key terms mentioned in the content","Check for related articles by the same author","Explore the main themes discussed"]}}async enhance(e,t,n){const r=Date.now();try{const t=e.replace(/\s+/g," ").replace(/\.\s+/g,". ").replace(/,\s+/g,", ").trim();return{enhanced:t,processingTime:Date.now()-r,stats:i.calculateStats(e,t)}}catch(e){return{error:`Failed to enhance content: ${e instanceof Error?e.message:"Unknown error"}`}}}}class d extends s{provider={name:"Anthropic Claude",id:"anthropic",apiEndpoint:"https://api.anthropic.com/v1",requiresAuth:!0,authType:"api_key",features:["summarize","analyze","suggestions","keyPoints"]};async summarize(e,t){this.validateApiKey();try{const t=await this.makeRequest(`${this.provider.apiEndpoint}/messages`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.apiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:"claude-3-sonnet-20240229",max_tokens:500,messages:[{role:"user",content:`Please provide a concise summary of the following content:\n\n${e}`}]})});return{summary:t.content?.[0]?.text||"No summary available"}}catch(e){return{error:`Failed to generate summary: ${e instanceof Error?e.message:"Unknown error"}`}}}async analyze(e,t){this.validateApiKey();try{const t=await this.makeRequest(`${this.provider.apiEndpoint}/messages`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.apiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:"claude-3-sonnet-20240229",max_tokens:800,messages:[{role:"user",content:`Analyze the following content and provide insights about its structure, themes, writing style, and key points:\n\n${e}`}]})});return{analysis:t.content?.[0]?.text||"No analysis available"}}catch(e){return{error:`Failed to generate analysis: ${e instanceof Error?e.message:"Unknown error"}`}}}async generateSuggestions(e,t){this.validateApiKey();try{const t=await this.makeRequest(`${this.provider.apiEndpoint}/messages`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.apiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:"claude-3-sonnet-20240229",max_tokens:400,messages:[{role:"user",content:`Based on the following content, provide 3-5 helpful suggestions for better understanding, related topics to explore, or ways to engage with the material:\n\n${e}`}]})});return{suggestions:(t.content?.[0]?.text||"").split("\n").filter((e=>e.trim().length>0&&(e.includes("•")||e.includes("-")||/^\d+\./.test(e.trim()))))}}catch(e){return{error:`Failed to generate suggestions: ${e instanceof Error?e.message:"Unknown error"}`}}}async enhance(e,t,n){this.validateApiKey();const r=Date.now(),a=n?.model||"claude-3-sonnet-20240229";try{const n=await this.makeRequest(`${this.provider.apiEndpoint}/messages`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":this.apiKey,"anthropic-version":"2023-06-01"},body:JSON.stringify({model:a,max_tokens:4096,messages:[{role:"user",content:t}]})}),s=n.content?.[0]?.text||e;return{enhanced:s,processingTime:Date.now()-r,stats:i.calculateStats(e,s)}}catch(e){return{error:`Failed to enhance content: ${e instanceof Error?e.message:"Unknown error"}`}}}}class h extends s{provider={name:"OpenRouter",id:"openrouter",apiEndpoint:"https://openrouter.ai/api/v1",requiresAuth:!0,authType:"api_key",features:["summarize","analyze","suggestions","keyPoints"]};async summarize(e,t){this.validateApiKey();try{const t=await this.makeRequest(`${this.provider.apiEndpoint}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,"HTTP-Referer":"https://novelsynth.com","X-Title":"NovelSynth"},body:JSON.stringify({model:"meta-llama/llama-3.2-3b-instruct:free",messages:[{role:"system",content:"You are a helpful assistant that provides concise summaries of content."},{role:"user",content:`Please provide a concise summary of the following content:\n\n${e}`}],max_tokens:500,temperature:.7})});return{summary:t.choices?.[0]?.message?.content||"No summary available"}}catch(e){return{error:`Failed to generate summary: ${e instanceof Error?e.message:"Unknown error"}`}}}async analyze(e,t){this.validateApiKey();try{const t=await this.makeRequest(`${this.provider.apiEndpoint}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,"HTTP-Referer":"https://novelsynth.com","X-Title":"NovelSynth"},body:JSON.stringify({model:"meta-llama/llama-3.2-3b-instruct:free",messages:[{role:"system",content:"You are a helpful assistant that analyzes content and provides insights."},{role:"user",content:`Analyze the following content and provide insights about its structure, themes, and key points:\n\n${e}`}],max_tokens:800,temperature:.7})});return{analysis:t.choices?.[0]?.message?.content||"No analysis available"}}catch(e){return{error:`Failed to generate analysis: ${e instanceof Error?e.message:"Unknown error"}`}}}async generateSuggestions(e,t){this.validateApiKey();try{const t=await this.makeRequest(`${this.provider.apiEndpoint}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,"HTTP-Referer":"https://novelsynth.com","X-Title":"NovelSynth"},body:JSON.stringify({model:"meta-llama/llama-3.2-3b-instruct:free",messages:[{role:"system",content:"You are a helpful assistant that provides useful suggestions based on content."},{role:"user",content:`Based on the following content, provide 3-5 helpful suggestions for better understanding or related topics to explore:\n\n${e}`}],max_tokens:400,temperature:.8})});return{suggestions:(t.choices?.[0]?.message?.content||"").split("\n").filter((e=>e.trim().length>0&&(e.includes("•")||e.includes("-")||/^\d+\./.test(e.trim()))))}}catch(e){return{error:`Failed to generate suggestions: ${e instanceof Error?e.message:"Unknown error"}`}}}async enhance(e,t,n){this.validateApiKey();const r=Date.now(),a=n?.model||"meta-llama/llama-3.2-3b-instruct:free";try{const n=await this.makeRequest(`${this.provider.apiEndpoint}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`,"HTTP-Referer":"https://novelsynth.com","X-Title":"NovelSynth"},body:JSON.stringify({model:a,messages:[{role:"user",content:t}],max_tokens:4096,temperature:.7})}),s=n.choices?.[0]?.message?.content||e;return{enhanced:s,processingTime:Date.now()-r,stats:i.calculateStats(e,s)}}catch(e){return{error:`Failed to enhance content: ${e instanceof Error?e.message:"Unknown error"}`}}}}class u{static trackers=new Map;static canMakeRequest(e,t,n=0){const r=`${e}:${t.id}`,a=this.getTracker(r,e,t.id),s=Date.now();return s-a.lastRequest>=6e4&&(a.requestCount=0,a.tokenCount=0),!(t.rateLimitRPM&&a.requestCount>=t.rateLimitRPM)&&!(t.rateLimitTPM&&a.tokenCount+n>t.rateLimitTPM)&&s>=a.nextAvailableTime}static recordRequest(e,t,n=0){const r=`${e}:${t.id}`,a=this.getTracker(r,e,t.id),s=Date.now();if(a.requestCount++,a.tokenCount+=n,a.lastRequest=s,t.rateLimitRPM){const e=6e4/t.rateLimitRPM;a.nextAvailableTime=Math.max(a.nextAvailableTime,s+e)}}static getWaitTime(e,t){const n=`${e}:${t.id}`,r=this.getTracker(n,e,t.id),a=Date.now();return Math.max(0,r.nextAvailableTime-a)}static async waitForRateLimit(e,t){const n=this.getWaitTime(e,t);n>0&&(console.log(`Rate limit reached for ${e}:${t.id}. Waiting ${n}ms...`),await new Promise((e=>setTimeout(e,n))))}static getTracker(e,t,n){return this.trackers.has(e)||this.trackers.set(e,{provider:t,model:n,requestCount:0,tokenCount:0,lastRequest:0,nextAvailableTime:0}),this.trackers.get(e)}static clearTrackers(){this.trackers.clear()}static getTrackers(){return Array.from(this.trackers.values())}}class m{static DEFAULT_OPTIONS={maxChunkSize:12e3,preserveImages:!0,preserveFormatting:!0,overlapSize:200};static segmentContent(e,t={}){const n={...this.DEFAULT_OPTIONS,...t},r=[],a=n.preserveImages?this.extractImages(e):[];let s=e;const i=[];return n.preserveImages&&a.forEach(((e,t)=>{const n=`__IMAGE_PLACEHOLDER_${t}__`;i.push(n),s=s.replace(e.originalTag,n)})),this.splitBySize(s,n.maxChunkSize,n.overlapSize).forEach(((e,t)=>{let s=e.content;const o=[];n.preserveImages&&i.forEach(((e,t)=>{if(s.includes(e)){const n=a[t];s=s.replace(e,n.originalTag),o.push({...n,position:s.indexOf(n.originalTag)})}})),r.push({id:`segment_${t}`,content:s,startIndex:e.startIndex,endIndex:e.endIndex,preserveImages:n.preserveImages,imagePositions:o})})),r}static reassembleSegments(e){const t=e.sort(((e,t)=>e.startIndex-t.startIndex));let n="",r=0;return t.forEach(((e,t)=>{if(0===t)n=e.content,r=e.endIndex;else{const t=Math.max(0,r-e.startIndex),a=t>0?e.content.substring(t):e.content;n+=a,r=e.endIndex}})),n}static extractImages(e){const t=[],n=/<img[^>]*>/gi;let r;for(;null!==(r=n.exec(e));){const e=r[0],n=e.match(/src=["']([^"']*)["']/i),a=e.match(/alt=["']([^"']*)["']/i),s=e.match(/title=["']([^"']*)["']/i);n&&t.push({src:n[1],alt:a?a[1]:void 0,title:s?s[1]:void 0,position:r.index,originalTag:e})}return t}static splitBySize(e,t,n){const r=[];if(e.length<=t)return[{content:e,startIndex:0,endIndex:e.length}];let a=0;for(;a<e.length;){const s=Math.min(a+t,e.length);let i=s;if(s<e.length){const t=Math.max(a,s-500),n=this.findLastSentenceBreak(e,t,s);n>a&&(i=n)}const o=e.substring(a,i);r.push({content:o,startIndex:a,endIndex:i}),a=Math.max(a+1,i-n)}return r}static findLastSentenceBreak(e,t,n){const r=e.substring(t,n);let a=-1;return[". ","! ","? ",".\n","!\n","?\n"].forEach((e=>{const t=r.lastIndexOf(e);t>a&&(a=t+e.length)})),a>-1?t+a:n}}let g=function(e){return e.NOVEL="novel",e.ARTICLE="article",e.NEWS="news",e.TECHNICAL="technical",e.GENERIC="generic",e}({});g.NOVEL,g.ARTICLE,g.NEWS,g.TECHNICAL,g.GENERIC,g.NOVEL,g.ARTICLE,g.NEWS,g.TECHNICAL,g.GENERIC;const p={gemini:[{id:"gemini-1.5-pro",name:"Gemini 1.5 Pro",maxTokens:2097152},{id:"gemini-1.5-flash",name:"Gemini 1.5 Flash",maxTokens:1048576},{id:"gemini-pro",name:"Gemini Pro",maxTokens:32768}],openai:[{id:"gpt-4-turbo",name:"GPT-4 Turbo",maxTokens:128e3},{id:"gpt-4",name:"GPT-4",maxTokens:32768},{id:"gpt-3.5-turbo",name:"GPT-3.5 Turbo",maxTokens:16384}],anthropic:[{id:"claude-3-opus-20240229",name:"Claude 3 Opus",maxTokens:2e5},{id:"claude-3-sonnet-20240229",name:"Claude 3 Sonnet",maxTokens:2e5},{id:"claude-3-haiku-20240307",name:"Claude 3 Haiku",maxTokens:2e5}],huggingface:[{id:"microsoft/DialoGPT-large",name:"DialoGPT Large",maxTokens:1024},{id:"facebook/blenderbot-400M-distill",name:"BlenderBot 400M",maxTokens:512}],openrouter:[{id:"meta-llama/llama-3.2-3b-instruct:free",name:"Llama 3.2 3B (Free)",maxTokens:32768},{id:"microsoft/wizardlm-2-8x22b",name:"WizardLM-2 8x22B",maxTokens:65536},{id:"anthropic/claude-3.5-sonnet",name:"Claude 3.5 Sonnet",maxTokens:2e5}]};g.NOVEL,g.TECHNICAL,g.NEWS,g.ARTICLE;class y{services=new Map;currentService=null;currentSettings=null;constructor(){this.initializeServices()}initializeServices(){[new o,new c,new l,new d,new h].forEach((e=>{this.services.set(e.provider.id,e)}))}getAvailableProviders(){return Array.from(this.services.values()).map((e=>e.provider))}getAvailableModels(e){return p[e]||[]}getAllAvailableModels(){const e={};return this.getAvailableProviders().forEach((t=>{e[t.id]=this.getAvailableModels(t.id)})),e}async setActiveProvider(e,t){const n=this.services.get(e);return n?(t&&n.setApiKey(t),this.currentService=n,!0):(console.error(`AI provider '${e}' not found`),!1)}getCurrentProvider(){return this.currentService?.provider||null}async enhance(e,t,n="enhance",r){if(!this.currentService||!this.currentSettings)return{error:"No AI provider selected or settings not loaded"};try{const a=this.currentSettings.selectedModels[n],s=this.getModelById(this.currentService.provider.id,a);return s?e.length>3*s.maxTokens?await this.enhanceWithSegmentation(e,t,s,r):await this.enhanceSingleContent(e,t,s,r):{error:`Model ${a} not found for provider ${this.currentService.provider.id}`}}catch(e){return{error:`Service error: ${e instanceof Error?e.message:"Unknown error"}`}}}async enhanceWithSegmentation(e,t,n,r){const a=m.segmentContent(e,{maxChunkSize:Math.floor(2.5*n.maxTokens),preserveImages:!0,preserveFormatting:!0}),s=[];let i=0,o=!1,c="";for(const e of a){this.currentSettings?.rateLimiting.enabled&&await u.waitForRateLimit(this.currentService.provider.id,n);const l=`${t}\n\n**Important:** This is part ${a.indexOf(e)+1} of ${a.length} segments. Maintain consistency with the overall content style and formatting.`;try{const t=await this.currentService.enhance(e.content,l,{...r,model:n.id});if(t.error){o=!0,c=t.error;break}s.push({...e,content:t.enhanced||e.content}),i+=t.processingTime||0,u.recordRequest(this.currentService.provider.id,n)}catch(e){o=!0,c=e instanceof Error?e.message:"Unknown error";break}}return o?{error:c}:{enhanced:m.reassembleSegments(s),processingTime:i}}async enhanceSingleContent(e,t,n,r){this.currentSettings?.rateLimiting.enabled&&await u.waitForRateLimit(this.currentService.provider.id,n);try{const a=await this.currentService.enhance(e,t,{...r,model:n.id});return u.recordRequest(this.currentService.provider.id,n),a}catch(e){return{error:`Enhancement failed: ${e instanceof Error?e.message:"Unknown error"}`}}}getModelById(e,t){return this.getAvailableModels(e).find((e=>e.id===t))||null}async summarize(e,t){if(!this.currentService||!this.currentSettings)return{error:"No AI provider selected or settings not loaded"};try{const n=this.currentSettings.selectedModels.summarize,r=this.getModelById(this.currentService.provider.id,n);if(!r)return{error:`Model ${n} not found`};this.currentSettings.rateLimiting.enabled&&await u.waitForRateLimit(this.currentService.provider.id,r);const a=await this.currentService.summarize(e,{...t,model:r.id});return u.recordRequest(this.currentService.provider.id,r),a}catch(e){return{error:`Service error: ${e instanceof Error?e.message:"Unknown error"}`}}}async analyze(e,t){if(!this.currentService||!this.currentSettings)return{error:"No AI provider selected or settings not loaded"};try{const n=this.currentSettings.selectedModels.analyze,r=this.getModelById(this.currentService.provider.id,n);if(!r)return{error:`Model ${n} not found`};this.currentSettings.rateLimiting.enabled&&await u.waitForRateLimit(this.currentService.provider.id,r);const a=await this.currentService.analyze(e,{...t,model:r.id});return u.recordRequest(this.currentService.provider.id,r),a}catch(e){return{error:`Service error: ${e instanceof Error?e.message:"Unknown error"}`}}}async generateSuggestions(e,t){if(!this.currentService||!this.currentSettings)return{error:"No AI provider selected or settings not loaded"};try{const n=this.currentSettings.selectedModels.suggestions,r=this.getModelById(this.currentService.provider.id,n);if(!r)return{error:`Model ${n} not found`};this.currentSettings.rateLimiting.enabled&&await u.waitForRateLimit(this.currentService.provider.id,r);const a=await this.currentService.generateSuggestions(e,{...t,model:r.id});return u.recordRequest(this.currentService.provider.id,r),a}catch(e){return{error:`Service error: ${e instanceof Error?e.message:"Unknown error"}`}}}async loadSettingsAndInitialize(e){this.currentSettings=e;const{selectedProvider:t,apiKeys:n}=e;if(t&&n[t])await this.setActiveProvider(t,n[t]);else{const e=this.getAvailableProviders();e.length>0&&await this.setActiveProvider(e[0].id)}}}const v={name:"FanFiction.Net",domains:["fanfiction.net","www.fanfiction.net","m.fanfiction.net"],selectors:{title:".storytitle",content:"#storytext",author:".xcontrast_txt",chapter:".storytitle",next:'[title="Next Chapter"]',previous:'[title="Previous Chapter"]'},isEnabled:!0,priority:1},f={name:"Archive of Our Own",domains:["archiveofourown.org","ao3.org"],selectors:{title:".title.heading",content:".userstuff.module",author:'.byline.heading a[rel="author"]',chapter:".title.heading",next:'.navigation.actions a[title="Next Chapter"]',previous:'.navigation.actions a[title="Previous Chapter"]'},isEnabled:!0,priority:1},w={name:"Royal Road",domains:["royalroad.com","www.royalroad.com"],selectors:{title:".fic-title h1",content:".chapter-content",author:".fic-title .author",chapter:".chapter-title",next:'.nav-buttons .btn:contains("Next Chapter")',previous:'.nav-buttons .btn:contains("Previous Chapter")'},isEnabled:!0,priority:1},S={name:"WebNovel.com",domains:["webnovel.com","www.webnovel.com"],selectors:{title:".det-hd h1",content:".cha-content .cha-words",author:".det-hd .author",chapter:".cha-tit",next:".cha-nav .j_next_chapter",previous:".cha-nav .j_pre_chapter"},isEnabled:!0,priority:1},b={name:"GeeksforGeeks",domains:["geeksforgeeks.org","www.geeksforgeeks.org"],selectors:{title:".article-title",content:".content, .text, article",author:".author-name",chapter:".article-title",next:".next-article",previous:".prev-article"},isEnabled:!0,priority:1},T={name:"Medium",domains:["medium.com","towardsdatascience.com","javascript.plainenglish.io"],selectors:{title:'h1[data-testid="storyTitle"]',content:"article section",author:'[data-testid="authorName"]',chapter:'h1[data-testid="storyTitle"]',next:".next-story",previous:".prev-story"},isEnabled:!0,priority:1},k={name:"Generic News",domains:["cnn.com","bbc.com","reuters.com","news.ycombinator.com","techcrunch.com","theverge.com"],selectors:{title:"h1, .headline, .article-title",content:".article-content, .story-body, .post-content, article",author:".byline, .author, .article-author",chapter:"h1, .headline",next:".next-article, .pagination-next",previous:".prev-article, .pagination-prev"},isEnabled:!0,priority:0};class E{handlers=[];enabledHandlers=new Set;constructor(){this.initializeHandlers()}initializeHandlers(){this.handlers=[v,f,w,S,b,T,k].sort(((e,t)=>t.priority-e.priority)),this.handlers.forEach((e=>{e.isEnabled&&this.enabledHandlers.add(e.name)}))}getHandlers(){return this.handlers.filter((e=>this.enabledHandlers.has(e.name)))}getAllHandlers(){return[...this.handlers]}getHandlerForDomain(e){const t=this.getHandlers();for(const n of t)for(const t of n.domains)if(e.includes(t)||t.includes(e))return n;return null}enableHandler(e){this.handlers.find((t=>t.name===e))&&this.enabledHandlers.add(e)}disableHandler(e){this.enabledHandlers.delete(e)}isHandlerEnabled(e){return this.enabledHandlers.has(e)}updateHandlerSettings(e){this.enabledHandlers.clear(),e.forEach((e=>this.enabledHandlers.add(e)))}addCustomHandler(e){const t=this.handlers.findIndex((t=>t.name===e.name));t>=0?this.handlers[t]=e:(this.handlers.push(e),this.handlers.sort(((e,t)=>t.priority-e.priority))),e.isEnabled&&this.enabledHandlers.add(e.name)}removeHandler(e){const t=this.handlers.findIndex((t=>t.name===e));return t>=0&&(this.handlers.splice(t,1),this.enabledHandlers.delete(e),!0)}}class A{static STORAGE_KEY="novelsynth_settings";static DEFAULT_SETTINGS={selectedProvider:"gemini",selectedModels:{enhance:"gemini-1.5-flash",summarize:"gemini-1.5-flash",analyze:"gemini-1.5-flash",suggestions:"gemini-1.5-flash"},apiKeys:{},enabledFeatures:["summarize","analyze","suggestions","enhance"],enabledHandlers:["FanFiction.Net","Archive of Our Own","Royal Road","WebNovel.com","GeeksforGeeks","Medium","Generic News"],theme:"auto",customPrompts:{enhancement:{},summary:{},permanent:{},website:{},novel:{}},autoDetectContentType:!0,showWordCount:!0,showProcessingBanner:!0,rateLimiting:{enabled:!0,waitTime:1e3,retryAttempts:3}};static async getSettings(){try{const e=(await chrome.storage.sync.get(this.STORAGE_KEY))[this.STORAGE_KEY];return e?{...this.DEFAULT_SETTINGS,...e}:this.DEFAULT_SETTINGS}catch(e){return console.error("Failed to load settings:",e),this.DEFAULT_SETTINGS}}static async saveSettings(e){try{const t={...await this.getSettings(),...e};return await chrome.storage.sync.set({[this.STORAGE_KEY]:t}),!0}catch(e){return console.error("Failed to save settings:",e),!1}}static async updateApiKey(e,t){try{const n=await this.getSettings();return n.apiKeys[e]=t,await this.saveSettings(n)}catch(e){return console.error("Failed to update API key:",e),!1}}static async removeApiKey(e){try{const t=await this.getSettings();return delete t.apiKeys[e],await this.saveSettings(t)}catch(e){return console.error("Failed to remove API key:",e),!1}}static async setSelectedProvider(e){return await this.saveSettings({selectedProvider:e})}static async setSelectedModel(e,t){try{const n={...(await this.getSettings()).selectedModels,[e]:t};return await this.saveSettings({selectedModels:n})}catch(e){return console.error("Failed to set selected model:",e),!1}}static async setSelectedModels(e){try{const t={...(await this.getSettings()).selectedModels,...e};return await this.saveSettings({selectedModels:t})}catch(e){return console.error("Failed to set selected models:",e),!1}}static async setCustomPrompt(e,t,n){try{const r=(await this.getSettings()).customPrompts||{enhancement:{},summary:{},permanent:{},website:{},novel:{}},a={...r};return a[e]={...r[e],[t]:n},await this.saveSettings({customPrompts:a})}catch(e){return console.error("Failed to set custom prompt:",e),!1}}static async removeCustomPrompt(e,t){try{const n=await this.getSettings();if(!n.customPrompts)return!0;const r={...n.customPrompts};return r[e]={...n.customPrompts[e]},delete r[e][t],await this.saveSettings({customPrompts:r})}catch(e){return console.error("Failed to remove custom prompt:",e),!1}}static async setRateLimitingSettings(e){try{const t={...(await this.getSettings()).rateLimiting,...e};return await this.saveSettings({rateLimiting:t})}catch(e){return console.error("Failed to set rate limiting settings:",e),!1}}static async setContentDetectionSettings(e){return await this.saveSettings(e)}static async toggleFeature(e){try{const t=[...(await this.getSettings()).enabledFeatures],n=t.indexOf(e);return n>=0?t.splice(n,1):t.push(e),await this.saveSettings({enabledFeatures:t})}catch(e){return console.error("Failed to toggle feature:",e),!1}}static async toggleHandler(e){try{const t=[...(await this.getSettings()).enabledHandlers],n=t.indexOf(e);return n>=0?t.splice(n,1):t.push(e),await this.saveSettings({enabledHandlers:t})}catch(e){return console.error("Failed to toggle handler:",e),!1}}static async clearAllData(){try{return await chrome.storage.sync.remove(this.STORAGE_KEY),!0}catch(e){return console.error("Failed to clear data:",e),!1}}static onSettingsChanged(e){chrome.storage.onChanged.addListener(((t,n)=>{if("sync"===n&&t[this.STORAGE_KEY]){const n=t[this.STORAGE_KEY].newValue;n&&e({...this.DEFAULT_SETTINGS,...n})}}))}}new class{constructor(){this.aiManager=new y,this.handlerManager=new E,this.init()}async init(){const e=await A.getSettings();await this.aiManager.loadSettingsAndInitialize(e),this.handlerManager.updateHandlerSettings(e.enabledHandlers),chrome.runtime.onMessage.addListener(((e,t,n)=>(this.handleMessage(e,t,n),!0))),A.onSettingsChanged((async e=>{await this.aiManager.loadSettingsAndInitialize(e),this.handlerManager.updateHandlerSettings(e.enabledHandlers)})),console.log("NovelSynth background service initialized")}async handleMessage(e,t,n){try{switch(e.type){case"ANALYZE_CONTENT":await this.handleAnalyzeContent(e.payload,n);break;case"GET_AI_RESPONSE":await this.handleGetAIResponse(e.payload,n);break;case"GET_AVAILABLE_MODELS":await this.handleGetAvailableModels(e.payload,n);break;case"GET_SETTINGS":await this.handleGetSettings(n);break;case"UPDATE_SETTINGS":await this.handleUpdateSettings(e.payload,n);break;default:n({error:"Unknown message type"})}}catch(e){console.error("Error handling message:",e),n({error:e instanceof Error?e.message:"Unknown error"})}}async handleAnalyzeContent(e,t){const{content:n,url:r}=e,s=new URL(r).hostname,i=this.handlerManager.getHandlerForDomain(s),o=i?[i]:this.handlerManager.getHandlers(),{ContentDetector:c}=await a.e(67).then(a.bind(a,67));t({analysis:c.analyzeContent(o),handler:i?.name||"Generic",success:!0})}async handleGetAIResponse(e,t){const{type:n,content:r,options:a}=e;let s;switch(n){case"enhance":s=await this.aiManager.enhance(r,"Enhance this content to improve readability, flow, and overall quality while maintaining the original meaning and style.","enhance",a);break;case"summarize":s=await this.aiManager.summarize(r,a);break;case"analyze":s=await this.aiManager.analyze(r,a);break;case"suggestions":s=await this.aiManager.generateSuggestions(r,a);break;default:s={error:"Invalid AI request type"}}t({response:s,provider:this.aiManager.getCurrentProvider(),success:!s.error})}async handleGetAvailableModels(e,t){try{const{providerId:n}=e;t(n?{success:!0,models:this.aiManager.getAvailableModels(n)}:{success:!0,models:this.aiManager.getAllAvailableModels()})}catch(e){t({success:!1,error:e instanceof Error?e.message:"Unknown error"})}}async handleGetSettings(e){e({settings:await A.getSettings(),providers:this.aiManager.getAvailableProviders(),handlers:this.handlerManager.getAllHandlers(),success:!0})}async handleUpdateSettings(e,t){const n=await A.saveSettings(e);if(n){const e=await A.getSettings();await this.aiManager.loadSettingsAndInitialize(e),this.handlerManager.updateHandlerSettings(e.enabledHandlers)}t({success:n})}}})();
//# sourceMappingURL=background.js.map