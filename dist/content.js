(()=>{"use strict";class n{static countWords(n){if(!n||"string"!=typeof n)return 0;const e=n.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim();return e?e.split(/\s+/).filter((n=>n.length>0)).length:0}static countCharacters(n){return n&&"string"==typeof n?n.replace(/<[^>]*>/g,"").length:0}static calculateStats(n,e){const t=this.countWords(n),s=this.countWords(e),a=s-t,i=t>0?a/t*100:0,o=this.countCharacters(n),r=this.countCharacters(e);return{originalWords:t,enhancedWords:s,wordsChanged:a,percentageChange:Math.round(100*i)/100,charactersOriginal:o,charactersEnhanced:r}}static formatWordCount(n){return n<1e3?n.toString():n<1e6?(n/1e3).toFixed(1)+"K":(n/1e6).toFixed(1)+"M"}static formatPercentageChange(n){return`${n>0?"+":""}${n.toFixed(1)}%`}static formatWordChange(n){return`${n>0?"+":""}${this.formatWordCount(Math.abs(n))}`}static getReadingTime(n){const e=Math.round(n/200);if(e<1)return"< 1 min";if(e<60)return`${e} min`;{const n=Math.floor(e/60),t=e%60;return t>0?`${n}h ${t}m`:`${n}h`}}static extractContentWordCount(n){if(!n)return 0;const e=n.cloneNode(!0);return["nav","header","footer","aside",".ads",".navigation",".breadcrumb",".social",".share",".comments",".author-bio"].forEach((n=>{e.querySelectorAll(n).forEach((n=>n.remove()))})),this.countWords(e.textContent||"")}}class e{bannerElement=null;constructor(n){this.config=n}showInitialBanner(e,t){if(!this.config.showProcessingBanner)return;this.removeBanner();const s=this.createBannerElement(),a=n.getReadingTime(t);s.innerHTML=`\n      <div class="novelsynth-banner-content">\n        <div class="novelsynth-banner-header">\n          <span class="novelsynth-banner-title">üìñ NovelSynth Ready</span>\n          <span class="novelsynth-banner-close" title="Close">&times;</span>\n        </div>\n        <div class="novelsynth-banner-stats">\n          <div class="stat-item">\n            <span class="stat-label">Words:</span>\n            <span class="stat-value">${n.formatWordCount(t)}</span>\n          </div>\n          <div class="stat-item">\n            <span class="stat-label">Reading Time:</span>\n            <span class="stat-value">${a}</span>\n          </div>\n          <div class="stat-item">\n            <span class="stat-label">AI Provider:</span>\n            <span class="stat-value">${this.config.provider}</span>\n          </div>\n          <div class="stat-item">\n            <span class="stat-label">Model:</span>\n            <span class="stat-value">${this.config.model}</span>\n          </div>\n        </div>\n      </div>\n    `,this.insertBanner(e,s),this.setupBannerEvents(s)}showProcessingBanner(n){if(!this.config.showProcessingBanner)return;this.removeBanner();const e=this.createBannerElement();e.classList.add("processing"),e.innerHTML=`\n      <div class="novelsynth-banner-content">\n        <div class="novelsynth-banner-header">\n          <span class="novelsynth-banner-title">ü§ñ Enhancing Content...</span>\n          <div class="novelsynth-spinner"></div>\n        </div>\n        <div class="novelsynth-banner-stats">\n          <div class="stat-item">\n            <span class="stat-label">AI Provider:</span>\n            <span class="stat-value">${this.config.provider}</span>\n          </div>\n          <div class="stat-item">\n            <span class="stat-label">Model:</span>\n            <span class="stat-value">${this.config.model}</span>\n          </div>\n          <div class="stat-item">\n            <span class="stat-label">Status:</span>\n            <span class="stat-value processing-text">Processing...</span>\n          </div>\n        </div>\n      </div>\n    `,this.insertBanner(n,e)}showCompletionBanner(e,t,s){if(!this.config.showProcessingBanner)return;this.removeBanner();const a=this.createBannerElement();a.classList.add("completed");const i=t.wordsChanged>=0?"positive":"negative",o=t.wordsChanged>=0?"üìà":"üìâ";a.innerHTML=`\n      <div class="novelsynth-banner-content">\n        <div class="novelsynth-banner-header">\n          <span class="novelsynth-banner-title">‚ú® Enhancement Complete</span>\n          <span class="novelsynth-banner-close" title="Close">&times;</span>\n        </div>\n        <div class="novelsynth-banner-stats">\n          <div class="stat-item">\n            <span class="stat-label">Original Words:</span>\n            <span class="stat-value">${n.formatWordCount(t.originalWords)}</span>\n          </div>\n          <div class="stat-item">\n            <span class="stat-label">Enhanced Words:</span>\n            <span class="stat-value">${n.formatWordCount(t.enhancedWords)}</span>\n          </div>\n          <div class="stat-item">\n            <span class="stat-label">Change:</span>\n            <span class="stat-value ${i}">\n              ${o} ${n.formatWordChange(t.wordsChanged)}\n              (${n.formatPercentageChange(t.percentageChange)})\n            </span>\n          </div>\n          <div class="stat-item">\n            <span class="stat-label">Processing Time:</span>\n            <span class="stat-value">${(s/1e3).toFixed(1)}s</span>\n          </div>\n          <div class="stat-item">\n            <span class="stat-label">Provider:</span>\n            <span class="stat-value">${this.config.provider} (${this.config.model})</span>\n          </div>\n        </div>\n      </div>\n    `,this.insertBanner(e,a),this.setupBannerEvents(a),setTimeout((()=>{this.removeBanner()}),1e4)}showErrorBanner(n,e){if(!this.config.showProcessingBanner)return;this.removeBanner();const t=this.createBannerElement();t.classList.add("error"),t.innerHTML=`\n      <div class="novelsynth-banner-content">\n        <div class="novelsynth-banner-header">\n          <span class="novelsynth-banner-title">‚ùå Enhancement Failed</span>\n          <span class="novelsynth-banner-close" title="Close">&times;</span>\n        </div>\n        <div class="novelsynth-banner-error">\n          <p>${e}</p>\n        </div>\n      </div>\n    `,this.insertBanner(n,t),this.setupBannerEvents(t),setTimeout((()=>{this.removeBanner()}),8e3)}removeBanner(){this.bannerElement&&(this.bannerElement.remove(),this.bannerElement=null)}createBannerElement(){const n=document.createElement("div");return n.className="novelsynth-processing-banner",n.innerHTML=this.getBannerStyles(),n}insertBanner(n,e){(n.parentElement||document.body).insertBefore(e,n),this.bannerElement=e}setupBannerEvents(n){const e=n.querySelector(".novelsynth-banner-close");e&&e.addEventListener("click",(()=>{this.removeBanner()}))}getBannerStyles(){return"\n      <style>\n        .novelsynth-processing-banner {\n          position: relative;\n          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n          color: white;\n          padding: 16px 20px;\n          margin: 16px 0;\n          border-radius: 12px;\n          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);\n          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n          z-index: 10000;\n          border: 2px solid rgba(255, 255, 255, 0.1);\n        }\n\n        .novelsynth-processing-banner.processing {\n          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n          animation: processingPulse 2s infinite;\n        }\n\n        .novelsynth-processing-banner.completed {\n          background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);\n        }\n\n        .novelsynth-processing-banner.error {\n          background: linear-gradient(135deg, #ff6b6b 0%, #ffa8a8 100%);\n        }\n\n        @keyframes processingPulse {\n          0%, 100% { opacity: 1; }\n          50% { opacity: 0.8; }\n        }\n\n        .novelsynth-banner-content {\n          max-width: 100%;\n        }\n\n        .novelsynth-banner-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          margin-bottom: 12px;\n        }\n\n        .novelsynth-banner-title {\n          font-size: 16px;\n          font-weight: 600;\n          margin: 0;\n        }\n\n        .novelsynth-banner-close {\n          cursor: pointer;\n          font-size: 20px;\n          font-weight: bold;\n          opacity: 0.7;\n          transition: opacity 0.2s;\n          padding: 0 4px;\n        }\n\n        .novelsynth-banner-close:hover {\n          opacity: 1;\n        }\n\n        .novelsynth-banner-stats {\n          display: grid;\n          grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n          gap: 12px;\n          margin-bottom: 8px;\n        }\n\n        .stat-item {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          background: rgba(255, 255, 255, 0.1);\n          padding: 8px 12px;\n          border-radius: 6px;\n          backdrop-filter: blur(10px);\n        }\n\n        .stat-label {\n          font-size: 13px;\n          opacity: 0.9;\n          font-weight: 500;\n        }\n\n        .stat-value {\n          font-size: 13px;\n          font-weight: 600;\n        }\n\n        .stat-value.positive {\n          color: #4ade80;\n        }\n\n        .stat-value.negative {\n          color: #f87171;\n        }\n\n        .processing-text {\n          animation: processingDots 1.5s infinite;\n        }\n\n        @keyframes processingDots {\n          0% { content: 'Processing'; }\n          33% { content: 'Processing.'; }\n          66% { content: 'Processing..'; }\n          100% { content: 'Processing...'; }\n        }\n\n        .novelsynth-spinner {\n          width: 16px;\n          height: 16px;\n          border: 2px solid rgba(255, 255, 255, 0.3);\n          border-top: 2px solid white;\n          border-radius: 50%;\n          animation: spin 1s linear infinite;\n        }\n\n        @keyframes spin {\n          0% { transform: rotate(0deg); }\n          100% { transform: rotate(360deg); }\n        }\n\n        .novelsynth-banner-error {\n          background: rgba(255, 255, 255, 0.1);\n          padding: 12px;\n          border-radius: 6px;\n          margin-top: 8px;\n        }\n\n        .novelsynth-banner-error p {\n          margin: 0;\n          font-size: 14px;\n          line-height: 1.4;\n        }\n\n        @media (max-width: 768px) {\n          .novelsynth-banner-stats {\n            grid-template-columns: 1fr;\n          }\n\n          .novelsynth-processing-banner {\n            margin: 8px;\n            padding: 12px 16px;\n          }\n        }\n      </style>\n    "}}new class{isInitialized=!1;analysis=null;novelSynthUI=null;processingBanner=null;settings=null;constructor(){this.init()}async init(){this.isInitialized||("loading"===document.readyState?document.addEventListener("DOMContentLoaded",(()=>this.initialize())):await this.initialize())}async initialize(){try{await this.loadSettings(),this.settings&&(this.processingBanner=new e({provider:this.settings.selectedProvider,model:this.settings.selectedModels.enhance,showWordCount:this.settings.showWordCount,showProcessingBanner:this.settings.showProcessingBanner})),await this.analyzeCurrentPage(),this.analysis?.isLongForm&&this.createNovelSynthUI(),this.isInitialized=!0,console.log("NovelSynth content script initialized")}catch(n){console.error("Failed to initialize NovelSynth:",n)}}async loadSettings(){try{const n=await this.sendMessage({type:"GET_SETTINGS",payload:{}});n.success&&(this.settings=n.settings)}catch(n){console.error("Failed to load settings:",n)}}async analyzeCurrentPage(){const n=this.extractPageContent();if(!(n.trim().length<100))try{const e=await this.sendMessage({type:"ANALYZE_CONTENT",payload:{content:n,url:window.location.href}});e.success&&(this.analysis=e.analysis,console.log("Content analysis:",this.analysis))}catch(n){console.error("Failed to analyze content:",n)}}extractPageContent(){const n=document.cloneNode(!0);["script","style","nav","header","footer","aside",".advertisement",".ads",".popup",".modal",".overlay"].forEach((e=>{n.querySelectorAll(e).forEach((n=>n.remove()))}));const e=["main","article",".content",".post-content",".article-content",".entry-content","#content",".chapter-content",".story-content"];for(const t of e){const e=n.querySelector(t);if(e&&e.textContent&&e.textContent.length>500)return e.textContent.trim().replace(/\s+/g," ")}return n.body?.textContent?.trim().replace(/\s+/g," ")||""}createNovelSynthUI(){this.novelSynthUI||(this.novelSynthUI=document.createElement("div"),this.novelSynthUI.id="novelsynth-fab",this.novelSynthUI.innerHTML=`\n      <div class="novelsynth-fab-button">\n        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>\n          <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>\n          <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>\n        </svg>\n      </div>\n      <div class="novelsynth-panel" style="display: none;">\n        <div class="novelsynth-header">\n          <h3>NovelSynth</h3>\n          <span class="novelsynth-close">&times;</span>\n        </div>\n        <div class="novelsynth-content">\n          <div class="novelsynth-info">\n            <p><strong>Content Type:</strong> ${this.analysis?.contentType||"Unknown"}</p>\n            <p><strong>Word Count:</strong> ${this.analysis?.wordCount?.toLocaleString()||"Unknown"}</p>\n            <p><strong>Reading Time:</strong> ${this.analysis?.readingTime||"Unknown"} min</p>\n          </div>          <div class="novelsynth-actions">\n            <button class="novelsynth-btn" data-action="enhance">‚ú® Enhance</button>\n            <button class="novelsynth-btn" data-action="summarize">üìÑ Summarize</button>\n            <button class="novelsynth-btn" data-action="analyze">üîç Analyze</button>\n            <button class="novelsynth-btn" data-action="suggestions">üí° Suggestions</button>\n          </div>\n          <div class="novelsynth-result" style="display: none;"></div>\n        </div>\n      </div>\n    `,this.addEventListeners(),document.body.appendChild(this.novelSynthUI))}addEventListeners(){if(!this.novelSynthUI)return;const n=this.novelSynthUI.querySelector(".novelsynth-fab-button"),e=this.novelSynthUI.querySelector(".novelsynth-panel"),t=this.novelSynthUI.querySelector(".novelsynth-close"),s=this.novelSynthUI.querySelectorAll(".novelsynth-btn");n?.addEventListener("click",(()=>{e.style.display="none"===e.style.display?"block":"none"})),t?.addEventListener("click",(()=>{e.style.display="none"})),s.forEach((n=>{n.addEventListener("click",(async n=>{const e=n.target.getAttribute("data-action");e&&await this.handleAction(e)}))}))}async handleAction(e){const t=this.novelSynthUI?.querySelector(".novelsynth-result");if(t){t.style.display="block",t.innerHTML='<div class="novelsynth-loading">Processing...</div>';try{const s=this.extractPageContent();if(n.countWords(s),this.processingBanner&&this.settings?.showProcessingBanner){const n=document.querySelector("main")||document.body;this.processingBanner.showProcessingBanner(n)}const a=await this.sendMessage({type:"GET_AI_RESPONSE",payload:{type:e,content:s.substring(0,8e3),options:{}}});this.processingBanner&&this.processingBanner.removeBanner(),a.success&&a.response?this.displayResult(e,a.response,t):t.innerHTML=`<div class="novelsynth-error">Error: ${a.response?.error||"Unknown error"}</div>`}catch(n){console.error(`Failed to ${e}:`,n),this.processingBanner&&this.processingBanner.removeBanner(),t.innerHTML=`<div class="novelsynth-error">Failed to ${e} content</div>`}}}getModelForAction(n){if(!this.settings)return"unknown";switch(n){case"enhance":default:return this.settings.selectedModels.enhance;case"summarize":return this.settings.selectedModels.summarize;case"analyze":return this.settings.selectedModels.analyze;case"suggestions":return this.settings.selectedModels.suggestions}}displayResult(n,e,t){let s=`<div class="novelsynth-result-header">${n.charAt(0).toUpperCase()+n.slice(1)} Result:</div>`;"summarize"===n&&e.summary?s+=`<div class="novelsynth-summary">${e.summary}</div>`:"analyze"===n&&e.analysis?s+=`<div class="novelsynth-analysis">${e.analysis}</div>`:"suggestions"===n&&e.suggestions?(s+='<div class="novelsynth-suggestions"><ul>',e.suggestions.forEach((n=>{s+=`<li>${n}</li>`})),s+="</ul></div>"):s+='<div class="novelsynth-error">No result available</div>',t.innerHTML=s}async sendMessage(n){return new Promise(((e,t)=>{chrome.runtime.sendMessage(n,(n=>{chrome.runtime.lastError?t(new Error(chrome.runtime.lastError.message)):e(n)}))}))}}})();
//# sourceMappingURL=content.js.map